---
import { actions } from "astro:actions";
import AdminLayout from "../../../layouts/AdminLayout.astro";
import { GrammarPointForm } from "../../../components/solid/admin/GrammarPointForm";

const { data: grammarPointsList } = await Astro.callAction(
  actions.getAllGrammarPoints,
  undefined,
);

if (!grammarPointsList) {
  throw new Error("Failed to load grammar points");
}

const createResult = Astro.getActionResult(actions.createGrammarPoint);
---

<AdminLayout title="Grammar Points">
  <div class="space-y-8">
    <div>
      <h1 class="text-4xl font-bold mb-2">Grammar Points Management</h1>
      <p class="text-slate-600">
        Create and manage grammar points for the application. Add structure,
        translations, and other details.
      </p>
    </div>

    <div>
      <h2 class="text-2xl font-semibold mb-4">Create New Grammar Point</h2>
      <form action={actions.createGrammarPoint} method="post">
        <GrammarPointForm
          success={!!createResult?.data}
          error={createResult?.error?.message}
          client:load
        />
      </form>
    </div>

    <div>
      <h2 class="text-2xl font-semibold mb-4">
        Existing Grammar Points ({grammarPointsList.length})
      </h2>
      <div class="bg-white rounded-lg border border-slate-200 overflow-hidden">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b bg-slate-50">
              <th class="px-6 py-3 text-left font-semibold text-slate-900"
                >Order</th
              >
              <th class="px-6 py-3 text-left font-semibold text-slate-900"
                >Short Title</th
              >
              <th class="px-6 py-3 text-left font-semibold text-slate-900"
                >Full Title</th
              >
              <th class="px-6 py-3 text-left font-semibold text-slate-900"
                >TORFL</th
              >
              <th class="px-6 py-3 text-left font-semibold text-slate-900"
                >Has Structure</th
              >
              <th class="px-6 py-3 text-center font-semibold text-slate-900"
                >Actions</th
              >
            </tr>
          </thead>
          <tbody>
            {
              grammarPointsList.map((gp) => (
                <tr class="border-b hover:bg-slate-50 transition">
                  <td class="px-6 py-3 text-slate-900 font-medium">
                    {gp.order}
                  </td>
                  <td class="px-6 py-3 text-slate-700">{gp.shortTitle}</td>
                  <td class="px-6 py-3 text-slate-700">{gp.title}</td>
                  <td class="px-6 py-3">
                    {gp.torfl ? (
                      <span class="inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium">
                        {gp.torfl}
                      </span>
                    ) : (
                      <span class="text-slate-400 text-xs">—</span>
                    )}
                  </td>
                  <td class="px-6 py-3">
                    {gp.structure ? (
                      <span class="inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium">
                        ✓
                      </span>
                    ) : (
                      <span class="text-slate-400 text-xs">—</span>
                    )}
                  </td>
                  <td class="px-6 py-3 text-center">
                    <a
                      href={`/admin/grammar/${gp.id}`}
                      class="inline-block text-blue-600 hover:underline text-xs font-medium"
                    >
                      Edit
                    </a>
                  </td>
                </tr>
              ))
            }
          </tbody>
        </table>

        {
          grammarPointsList.length === 0 && (
            <div class="px-6 py-12 text-center text-slate-500">
              <p>No grammar points yet. Create one using the form above!</p>
            </div>
          )
        }
      </div>
    </div>
  </div>
</AdminLayout>
