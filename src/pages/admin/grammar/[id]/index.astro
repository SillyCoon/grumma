---
import { actions } from "astro:actions";
import AdminLayout from "../../../../layouts/AdminLayout.astro";
import { GrammarPointForm } from "../../../../components/solid/admin/GrammarPointForm";
import { ExercisesForm } from "~/features/exercise/create/ExercisesForm";

const { id } = Astro.params;

if (!id || isNaN(Number(id))) {
  return Astro.redirect("/admin/grammar");
}

const { data: grammarPoint } = await Astro.callAction(
  actions.getGrammarPointById,
  {
    id: Number(id),
  },
);

if (!grammarPoint) {
  return Astro.redirect("/admin/grammar");
}
---

<AdminLayout title={`Edit: ${grammarPoint.shortTitle}`}>
  <div class="space-y-8">
    <div>
      <a
        href="/admin/grammar"
        class="text-blue-600 hover:underline text-sm mb-4 inline-block"
      >
        ‚Üê Back to Grammar Points
      </a>
      <h1 class="text-4xl font-bold mt-4">Edit Grammar Point</h1>
      <p class="text-slate-600 mt-2">ID: {grammarPoint.id}</p>
    </div>

    <!-- Edit Form -->
    <GrammarPointForm
      client:load
      initialData={{
        id: grammarPoint.id,
        shortTitle: grammarPoint.shortTitle,
        order: grammarPoint.order,
        structure: grammarPoint.structure ?? undefined,
        detailedTitle: grammarPoint.detailedTitle ?? undefined,
        englishTitle: grammarPoint.englishTitle ?? undefined,
        torfl: grammarPoint.torfl ?? undefined,
      }}
    />

    <div class="space-y-4 pt-5">
      <div>
        <h2 class="text-2xl font-semibold mb-4">
          Exercises ({grammarPoint.exercises.length})
        </h2>
      </div>
      <ExercisesForm grammarPointId={grammarPoint.id} client:only="solid-js" />
    </div>
  </div>
</AdminLayout>
